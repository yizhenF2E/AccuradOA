function tdBackground(a,b){function F(){G(),I(),J(),K(),P(),L(r.offsetWidth,r.offsetHeight),M()}function G(){A=new c.WebGLRenderer,B=new c.CanvasRenderer,C=new c.SVGRenderer,H(k.renderer)}function H(a){switch(v&&t.removeChild(v.element),a){case h:v=A;break;case i:v=B;break;case j:v=C}v.setSize(r.offsetWidth,r.offsetHeight),t.appendChild(v.element)}function I(){w=new c.Scene}function J(){w.remove(x),v.clear(),y=new c.Plane(e.width*v.width,e.height*v.height,e.segments,e.slices),z=new c.Material(e.ambient,e.diffuse),x=new c.Mesh(y,z),w.add(x);var a,b;for(a=y.vertices.length-1;a>=0;a--)b=y.vertices[a],b.anchor=c.Vector3.clone(b.position),b.step=c.Vector3.create(Math.randomInRange(.2,1),Math.randomInRange(.2,1),Math.randomInRange(.2,1)),b.time=Math.randomInRange(0,Math.PIM2)}function K(){var a,b;for(a=w.lights.length-1;a>=0;a--)b=w.lights[a],w.remove(b);for(v.clear(),a=0;a<f.count;a++)b=new c.Light(f.ambient,f.diffuse),b.ambientHex=b.ambient.format(),b.diffuseHex=b.diffuse.format(),w.add(b),b.mass=Math.randomInRange(.5,1),b.velocity=c.Vector3.create(),b.acceleration=c.Vector3.create(),b.force=c.Vector3.create(),b.ring=document.createElementNS(c.SVGNS,"circle"),b.ring.setAttributeNS(null,"stroke",b.ambientHex),b.ring.setAttributeNS(null,"stroke-width","0.5"),b.ring.setAttributeNS(null,"fill","none"),b.ring.setAttributeNS(null,"r","10"),b.core=document.createElementNS(c.SVGNS,"circle"),b.core.setAttributeNS(null,"fill",b.diffuseHex),b.core.setAttributeNS(null,"r","4")}function L(a,b){v.setSize(a,b),c.Vector3.set(p,v.halfWidth,v.halfHeight),J()}function M(){n=Date.now()-o,N(),O(),requestAnimationFrame(M)}function N(){var a,b,d,g,h,i,j,k=e.depth/2;for(c.Vector3.copy(f.bounds,p),c.Vector3.multiplyScalar(f.bounds,f.xyScalar),c.Vector3.setZ(q,f.zOffset),f.autopilot&&(a=Math.sin(f.step[0]*n*f.speed),b=Math.cos(f.step[1]*n*f.speed),c.Vector3.set(q,f.bounds[0]*a,f.bounds[1]*b,f.zOffset)),g=w.lights.length-1;g>=0;g--){h=w.lights[g],c.Vector3.setZ(h.position,f.zOffset);var l=Math.clamp(c.Vector3.distanceSquared(h.position,q),f.minDistance,f.maxDistance),m=f.gravity*h.mass/l;c.Vector3.subtractVectors(h.force,q,h.position),c.Vector3.normalise(h.force),c.Vector3.multiplyScalar(h.force,m),c.Vector3.set(h.acceleration),c.Vector3.add(h.acceleration,h.force),c.Vector3.add(h.velocity,h.acceleration),c.Vector3.multiplyScalar(h.velocity,f.dampening),c.Vector3.limit(h.velocity,f.minLimit,f.maxLimit),c.Vector3.add(h.position,h.velocity)}for(i=y.vertices.length-1;i>=0;i--)j=y.vertices[i],a=Math.sin(j.time+j.step[0]*n*e.speed),b=Math.cos(j.time+j.step[1]*n*e.speed),d=Math.sin(j.time+j.step[2]*n*e.speed),c.Vector3.set(j.position,e.xRange*y.segmentWidth*a,e.yRange*y.sliceHeight*b,e.zRange*k*d-k),c.Vector3.add(j.position,j.anchor);y.dirty=!0}function O(){if(v.render(w),f.draw){var a,b,c,d;for(a=w.lights.length-1;a>=0;a--)switch(d=w.lights[a],b=d.position[0],c=d.position[1],k.renderer){case i:v.context.lineWidth=.5,v.context.beginPath(),v.context.arc(b,c,10,0,Math.PIM2),v.context.strokeStyle=d.ambientHex,v.context.stroke(),v.context.beginPath(),v.context.arc(b,c,4,0,Math.PIM2),v.context.fillStyle=d.diffuseHex,v.context.fill();break;case j:b+=v.halfWidth,c=v.halfHeight-c,d.core.setAttributeNS(null,"fill",d.diffuseHex),d.core.setAttributeNS(null,"cx",b),d.core.setAttributeNS(null,"cy",c),v.element.appendChild(d.core),d.ring.setAttributeNS(null,"stroke",d.ambientHex),d.ring.setAttributeNS(null,"cx",b),d.ring.setAttributeNS(null,"cy",c),v.element.appendChild(d.ring)}}}function P(){window.addEventListener("resize",T),!1===b.mode.move||r.addEventListener("mousemove",S)}function S(a){c.Vector3.set(q,a.x,v.height-a.y),c.Vector3.subtract(q,p)}function T(a){L(r.offsetWidth,r.offsetHeight),O()}function U(){var a={FRONT:0,BACK:1,DOUBLE:2,SVGNS:"http://www.w3.org/2000/svg"};return a.Array="function"==typeof Float32Array?Float32Array:Array,a.Utils={isNumber:function(a){return!isNaN(parseFloat(a))&&isFinite(a)}},function(){for(var a=0,b=["ms","moz","webkit","o"],c=0;c<b.length&&!window.requestAnimationFrame;++c)window.requestAnimationFrame=window[b[c]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[b[c]+"CancelAnimationFrame"]||window[b[c]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(b,c){var d=(new Date).getTime(),e=Math.max(0,16-(d-a)),f=window.setTimeout(function(){b(d+e)},e);return a=d+e,f}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(a){clearTimeout(a)})}(),Math.PIM2=2*Math.PI,Math.PID2=Math.PI/2,Math.randomInRange=function(a,b){return a+(b-a)*Math.random()},Math.clamp=function(a,b,c){return a=Math.max(a,b),a=Math.min(a,c)},a.Vector3={create:function(b,c,d){var e=new a.Array(3);return this.set(e,b,c,d),e},clone:function(a){var b=this.create();return this.copy(b,a),b},set:function(a,b,c,d){return a[0]=b||0,a[1]=c||0,a[2]=d||0,this},setX:function(a,b){return a[0]=b||0,this},setY:function(a,b){return a[1]=b||0,this},setZ:function(a,b){return a[2]=b||0,this},copy:function(a,b){return a[0]=b[0],a[1]=b[1],a[2]=b[2],this},add:function(a,b){return a[0]+=b[0],a[1]+=b[1],a[2]+=b[2],this},addVectors:function(a,b,c){return a[0]=b[0]+c[0],a[1]=b[1]+c[1],a[2]=b[2]+c[2],this},addScalar:function(a,b){return a[0]+=b,a[1]+=b,a[2]+=b,this},subtract:function(a,b){return a[0]-=b[0],a[1]-=b[1],a[2]-=b[2],this},subtractVectors:function(a,b,c){return a[0]=b[0]-c[0],a[1]=b[1]-c[1],a[2]=b[2]-c[2],this},subtractScalar:function(a,b){return a[0]-=b,a[1]-=b,a[2]-=b,this},multiply:function(a,b){return a[0]*=b[0],a[1]*=b[1],a[2]*=b[2],this},multiplyVectors:function(a,b,c){return a[0]=b[0]*c[0],a[1]=b[1]*c[1],a[2]=b[2]*c[2],this},multiplyScalar:function(a,b){return a[0]*=b,a[1]*=b,a[2]*=b,this},divide:function(a,b){return a[0]/=b[0],a[1]/=b[1],a[2]/=b[2],this},divideVectors:function(a,b,c){return a[0]=b[0]/c[0],a[1]=b[1]/c[1],a[2]=b[2]/c[2],this},divideScalar:function(a,b){return 0!==b?(a[0]/=b,a[1]/=b,a[2]/=b):(a[0]=0,a[1]=0,a[2]=0),this},cross:function(a,b){var c=a[0],d=a[1],e=a[2];return a[0]=d*b[2]-e*b[1],a[1]=e*b[0]-c*b[2],a[2]=c*b[1]-d*b[0],this},crossVectors:function(a,b,c){return a[0]=b[1]*c[2]-b[2]*c[1],a[1]=b[2]*c[0]-b[0]*c[2],a[2]=b[0]*c[1]-b[1]*c[0],this},min:function(a,b){return a[0]<b&&(a[0]=b),a[1]<b&&(a[1]=b),a[2]<b&&(a[2]=b),this},max:function(a,b){return a[0]>b&&(a[0]=b),a[1]>b&&(a[1]=b),a[2]>b&&(a[2]=b),this},clamp:function(a,b,c){return this.min(a,b),this.max(a,c),this},limit:function(a,b,c){var d=this.length(a);return null!==b&&d<b?this.setLength(a,b):null!==c&&d>c&&this.setLength(a,c),this},dot:function(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]},normalise:function(a){return this.divideScalar(a,this.length(a))},negate:function(a){return this.multiplyScalar(a,-1)},distanceSquared:function(a,b){var c=a[0]-b[0],d=a[1]-b[1],e=a[2]-b[2];return c*c+d*d+e*e},distance:function(a,b){return Math.sqrt(this.distanceSquared(a,b))},lengthSquared:function(a){return a[0]*a[0]+a[1]*a[1]+a[2]*a[2]},length:function(a){return Math.sqrt(this.lengthSquared(a))},setLength:function(a,b){var c=this.length(a);return 0!==c&&b!==c&&this.multiplyScalar(a,b/c),this}},a.Vector4={create:function(b,c,d,e){var f=new a.Array(4);return this.set(f,b,c,d),f},set:function(a,b,c,d,e){return a[0]=b||0,a[1]=c||0,a[2]=d||0,a[3]=e||0,this},setX:function(a,b){return a[0]=b||0,this},setY:function(a,b){return a[1]=b||0,this},setZ:function(a,b){return a[2]=b||0,this},setW:function(a,b){return a[3]=b||0,this},add:function(a,b){return a[0]+=b[0],a[1]+=b[1],a[2]+=b[2],a[3]+=b[3],this},multiplyVectors:function(a,b,c){return a[0]=b[0]*c[0],a[1]=b[1]*c[1],a[2]=b[2]*c[2],a[3]=b[3]*c[3],this},multiplyScalar:function(a,b){return a[0]*=b,a[1]*=b,a[2]*=b,a[3]*=b,this},min:function(a,b){return a[0]<b&&(a[0]=b),a[1]<b&&(a[1]=b),a[2]<b&&(a[2]=b),a[3]<b&&(a[3]=b),this},max:function(a,b){return a[0]>b&&(a[0]=b),a[1]>b&&(a[1]=b),a[2]>b&&(a[2]=b),a[3]>b&&(a[3]=b),this},clamp:function(a,b,c){return this.min(a,b),this.max(a,c),this}},a.Color=function(b,c){this.rgba=a.Vector4.create(),this.hex=b||"#000000",this.opacity=a.Utils.isNumber(c)?c:1,this.set(this.hex,this.opacity)},a.Color.prototype={set:function(b,c){b=b.replace("#","");var d=b.length/3;return this.rgba[0]=parseInt(b.substring(0*d,1*d),16)/255,this.rgba[1]=parseInt(b.substring(1*d,2*d),16)/255,this.rgba[2]=parseInt(b.substring(2*d,3*d),16)/255,this.rgba[3]=a.Utils.isNumber(c)?c:this.rgba[3],this},hexify:function(a){var b=Math.ceil(255*a).toString(16);return 1===b.length&&(b="0"+b),b},format:function(){var a=this.hexify(this.rgba[0]),b=this.hexify(this.rgba[1]),c=this.hexify(this.rgba[2]);return this.hex="#"+a+b+c,this.hex}},a.Object=function(){this.position=a.Vector3.create()},a.Object.prototype={setPosition:function(b,c,d){return a.Vector3.set(this.position,b,c,d),this}},a.Light=function(b,c){a.Object.call(this),this.ambient=new a.Color(b||"#FFFFFF"),this.diffuse=new a.Color(c||"#FFFFFF"),this.ray=a.Vector3.create()},a.Light.prototype=Object.create(a.Object.prototype),a.Vertex=function(b,c,d){this.position=a.Vector3.create(b,c,d)},a.Vertex.prototype={setPosition:function(b,c,d){return a.Vector3.set(this.position,b,c,d),this}},a.Triangle=function(b,c,d){this.a=b||new a.Vertex,this.b=c||new a.Vertex,this.c=d||new a.Vertex,this.vertices=[this.a,this.b,this.c],this.u=a.Vector3.create(),this.v=a.Vector3.create(),this.centroid=a.Vector3.create(),this.normal=a.Vector3.create(),this.color=new a.Color,this.polygon=document.createElementNS(a.SVGNS,"polygon"),this.polygon.setAttributeNS(null,"stroke-linejoin","round"),this.polygon.setAttributeNS(null,"stroke-miterlimit","1"),this.polygon.setAttributeNS(null,"stroke-width","1"),this.computeCentroid(),this.computeNormal()},a.Triangle.prototype={computeCentroid:function(){return this.centroid[0]=this.a.position[0]+this.b.position[0]+this.c.position[0],this.centroid[1]=this.a.position[1]+this.b.position[1]+this.c.position[1],this.centroid[2]=this.a.position[2]+this.b.position[2]+this.c.position[2],a.Vector3.divideScalar(this.centroid,3),this},computeNormal:function(){return a.Vector3.subtractVectors(this.u,this.b.position,this.a.position),a.Vector3.subtractVectors(this.v,this.c.position,this.a.position),a.Vector3.crossVectors(this.normal,this.u,this.v),a.Vector3.normalise(this.normal),this}},a.Geometry=function(){this.vertices=[],this.triangles=[],this.dirty=!1},a.Geometry.prototype={update:function(){if(this.dirty){var a,b;for(a=this.triangles.length-1;a>=0;a--)b=this.triangles[a],b.computeCentroid(),b.computeNormal();this.dirty=!1}return this}},a.Plane=function(b,c,d,e){a.Geometry.call(this),this.width=b||100,this.height=c||100,this.segments=d||4,this.slices=e||4,this.segmentWidth=this.width/this.segments,this.sliceHeight=this.height/this.slices;var f,g,h,i,j,k,l,n=[],o=-.5*this.width,p=.5*this.height;for(f=0;f<=this.segments;f++)for(n.push([]),g=0;g<=this.slices;g++)l=new a.Vertex(o+f*this.segmentWidth,p-g*this.sliceHeight),n[f].push(l),this.vertices.push(l);for(f=0;f<this.segments;f++)for(g=0;g<this.slices;g++){h=n[f+0][g+0],i=n[f+0][g+1],j=n[f+1][g+0],k=n[f+1][g+1];var q=new a.Triangle(h,i,j),r=new a.Triangle(j,i,k);this.triangles.push(q,r)}},a.Plane.prototype=Object.create(a.Geometry.prototype),a.Material=function(b,c){this.ambient=new a.Color(b||"#444444"),this.diffuse=new a.Color(c||"#FFFFFF"),this.slave=new a.Color},a.Mesh=function(b,c){a.Object.call(this),this.geometry=b||new a.Geometry,this.material=c||new a.Material,this.side=a.FRONT,this.visible=!0},a.Mesh.prototype=Object.create(a.Object.prototype),a.Mesh.prototype.update=function(b,c){var d,e,f,g,h;if(this.geometry.update(),c)for(d=this.geometry.triangles.length-1;d>=0;d--){for(e=this.geometry.triangles[d],a.Vector4.set(e.color.rgba),f=b.length-1;f>=0;f--)g=b[f],a.Vector3.subtractVectors(g.ray,g.position,e.centroid),a.Vector3.normalise(g.ray),h=a.Vector3.dot(e.normal,g.ray),this.side===a.FRONT?h=Math.max(h,0):this.side===a.BACK?h=Math.abs(Math.min(h,0)):this.side===a.DOUBLE&&(h=Math.max(Math.abs(h),0)),a.Vector4.multiplyVectors(this.material.slave.rgba,this.material.ambient.rgba,g.ambient.rgba),a.Vector4.add(e.color.rgba,this.material.slave.rgba),a.Vector4.multiplyVectors(this.material.slave.rgba,this.material.diffuse.rgba,g.diffuse.rgba),a.Vector4.multiplyScalar(this.material.slave.rgba,h),a.Vector4.add(e.color.rgba,this.material.slave.rgba);a.Vector4.clamp(e.color.rgba,0,1)}return this},a.Scene=function(){this.meshes=[],this.lights=[]},a.Scene.prototype={add:function(b){return b instanceof a.Mesh&&!~this.meshes.indexOf(b)?this.meshes.push(b):b instanceof a.Light&&!~this.lights.indexOf(b)&&this.lights.push(b),this},remove:function(b){return b instanceof a.Mesh&&~this.meshes.indexOf(b)?this.meshes.splice(this.meshes.indexOf(b),1):b instanceof a.Light&&~this.lights.indexOf(b)&&this.lights.splice(this.lights.indexOf(b),1),this}},a.Renderer=function(){this.width=0,this.height=0,this.halfWidth=0,this.halfHeight=0},a.Renderer.prototype={setSize:function(a,b){if(this.width!==a||this.height!==b)return this.width=a,this.height=b,this.halfWidth=.5*this.width,this.halfHeight=.5*this.height,this},clear:function(){return this},render:function(a){return this}},a.CanvasRenderer=function(){a.Renderer.call(this),this.element=document.createElement("canvas"),this.element.style.display="block",this.context=this.element.getContext("2d"),this.setSize(this.element.width,this.element.height)},a.CanvasRenderer.prototype=Object.create(a.Renderer.prototype),a.CanvasRenderer.prototype.setSize=function(b,c){return a.Renderer.prototype.setSize.call(this,b,c),this.element.width=b,this.element.height=c,this.context.setTransform(1,0,0,-1,this.halfWidth,this.halfHeight),this},a.CanvasRenderer.prototype.clear=function(){return a.Renderer.prototype.clear.call(this),this.context.clearRect(-this.halfWidth,-this.halfHeight,this.width,this.height),this},a.CanvasRenderer.prototype.render=function(b){a.Renderer.prototype.render.call(this,b);var c,d,e,f,g;for(this.clear(),this.context.lineJoin="round",this.context.lineWidth=1,c=b.meshes.length-1;c>=0;c--)if(d=b.meshes[c],d.visible)for(d.update(b.lights,!0),e=d.geometry.triangles.length-1;e>=0;e--)f=d.geometry.triangles[e],g=f.color.format(),this.context.beginPath(),this.context.moveTo(f.a.position[0],f.a.position[1]),this.context.lineTo(f.b.position[0],f.b.position[1]),this.context.lineTo(f.c.position[0],f.c.position[1]),this.context.closePath(),this.context.strokeStyle=g,this.context.fillStyle=g,this.context.stroke(),this.context.fill();return this},a.WebGLRenderer=function(){a.Renderer.call(this),this.element=document.createElement("canvas"),this.element.style.display="block",this.vertices=null,this.lights=null;var b={preserveDrawingBuffer:!1,premultipliedAlpha:!0,antialias:!0,stencil:!0,alpha:!0};if(this.gl=this.getContext(this.element,b),this.unsupported=!this.gl,this.unsupported)return"WebGL is not supported by your browser.";this.gl.clearColor(0,0,0,0),this.gl.enable(this.gl.DEPTH_TEST),this.setSize(this.element.width,this.element.height)},a.WebGLRenderer.prototype=Object.create(a.Renderer.prototype),a.WebGLRenderer.prototype.getContext=function(a,b){var c=!1;try{if(!(c=a.getContext("experimental-webgl",b)))throw"Error creating WebGL context."}catch(a){console.error(a)}return c},a.WebGLRenderer.prototype.setSize=function(b,c){if(a.Renderer.prototype.setSize.call(this,b,c),!this.unsupported)return this.element.width=b,this.element.height=c,this.gl.viewport(0,0,b,c),this},a.WebGLRenderer.prototype.clear=function(){if(a.Renderer.prototype.clear.call(this),!this.unsupported)return this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT),this},a.WebGLRenderer.prototype.render=function(b){if(a.Renderer.prototype.render.call(this,b),!this.unsupported){var c,d,e,f,g,h,i,j,k,l,m,n,q,r,s,o=!1,p=b.lights.length,u=0;if(this.clear(),this.lights!==p){if(this.lights=p,!(this.lights>0))return;this.buildProgram(p)}if(this.program){for(c=b.meshes.length-1;c>=0;c--)d=b.meshes[c],d.geometry.dirty&&(o=!0),d.update(b.lights,!1),u+=3*d.geometry.triangles.length;if(o||this.vertices!==u){this.vertices=u;for(j in this.program.attributes){for(l=this.program.attributes[j],l.data=new a.Array(u*l.size),q=0,c=b.meshes.length-1;c>=0;c--)for(d=b.meshes[c],e=0,f=d.geometry.triangles.length;e<f;e++)for(g=d.geometry.triangles[e],r=0,s=g.vertices.length;r<s;r++){switch(vertex=g.vertices[r],j){case"side":this.setBufferData(q,l,d.side);break;case"position":this.setBufferData(q,l,vertex.position);break;case"centroid":this.setBufferData(q,l,g.centroid);break;case"normal":this.setBufferData(q,l,g.normal);break;case"ambient":this.setBufferData(q,l,d.material.ambient.rgba);break;case"diffuse":this.setBufferData(q,l,d.material.diffuse.rgba)}q++}this.gl.bindBuffer(this.gl.ARRAY_BUFFER,l.buffer),this.gl.bufferData(this.gl.ARRAY_BUFFER,l.data,this.gl.DYNAMIC_DRAW),this.gl.enableVertexAttribArray(l.location),this.gl.vertexAttribPointer(l.location,l.size,this.gl.FLOAT,!1,0,0)}}for(this.setBufferData(0,this.program.uniforms.resolution,[this.width,this.height,this.width]),h=p-1;h>=0;h--)i=b.lights[h],this.setBufferData(h,this.program.uniforms.lightPosition,i.position),this.setBufferData(h,this.program.uniforms.lightAmbient,i.ambient.rgba),this.setBufferData(h,this.program.uniforms.lightDiffuse,i.diffuse.rgba);for(k in this.program.uniforms)switch(l=this.program.uniforms[k],n=l.location,m=l.data,l.structure){case"3f":this.gl.uniform3f(n,m[0],m[1],m[2]);break;case"3fv":this.gl.uniform3fv(n,m);break;case"4fv":this.gl.uniform4fv(n,m)}}return this.gl.drawArrays(this.gl.TRIANGLES,0,this.vertices),this}},a.WebGLRenderer.prototype.setBufferData=function(b,c,d){if(a.Utils.isNumber(d))c.data[b*c.size]=d;else for(var e=d.length-1;e>=0;e--)c.data[b*c.size+e]=d[e]},a.WebGLRenderer.prototype.buildProgram=function(b){if(!this.unsupported){var c=a.WebGLRenderer.VS(b),d=a.WebGLRenderer.FS(b),e=c+d;if(!this.program||this.program.code!==e){var f=this.gl.createProgram(),g=this.buildShader(this.gl.VERTEX_SHADER,c),h=this.buildShader(this.gl.FRAGMENT_SHADER,d);if(this.gl.attachShader(f,g),this.gl.attachShader(f,h),this.gl.linkProgram(f),!this.gl.getProgramParameter(f,this.gl.LINK_STATUS)){var i=this.gl.getError(),j=this.gl.getProgramParameter(f,this.gl.VALIDATE_STATUS);return console.error("Could not initialise shader.\nVALIDATE_STATUS: "+j+"\nERROR: "+i),null}return this.gl.deleteShader(h),this.gl.deleteShader(g),f.code=e,f.attributes={side:this.buildBuffer(f,"attribute","aSide",1,"f"),position:this.buildBuffer(f,"attribute","aPosition",3,"v3"),centroid:this.buildBuffer(f,"attribute","aCentroid",3,"v3"),normal:this.buildBuffer(f,"attribute","aNormal",3,"v3"),ambient:this.buildBuffer(f,"attribute","aAmbient",4,"v4"),diffuse:this.buildBuffer(f,"attribute","aDiffuse",4,"v4")},f.uniforms={resolution:this.buildBuffer(f,"uniform","uResolution",3,"3f",1),lightPosition:this.buildBuffer(f,"uniform","uLightPosition",3,"3fv",b),lightAmbient:this.buildBuffer(f,"uniform","uLightAmbient",4,"4fv",b),lightDiffuse:this.buildBuffer(f,"uniform","uLightDiffuse",4,"4fv",b)},this.program=f,this.gl.useProgram(this.program),f}}},a.WebGLRenderer.prototype.buildShader=function(a,b){if(!this.unsupported){var c=this.gl.createShader(a);return this.gl.shaderSource(c,b),this.gl.compileShader(c),this.gl.getShaderParameter(c,this.gl.COMPILE_STATUS)?c:(console.error(this.gl.getShaderInfoLog(c)),null)}},a.WebGLRenderer.prototype.buildBuffer=function(b,c,d,e,f,g){var h={buffer:this.gl.createBuffer(),size:e,structure:f,data:null};switch(c){case"attribute":h.location=this.gl.getAttribLocation(b,d);break;case"uniform":h.location=this.gl.getUniformLocation(b,d)}return g&&(h.data=new a.Array(g*e)),h},a.WebGLRenderer.VS=function(a){return["precision mediump float;","#define LIGHTS "+a,"attribute float aSide;","attribute vec3 aPosition;","attribute vec3 aCentroid;","attribute vec3 aNormal;","attribute vec4 aAmbient;","attribute vec4 aDiffuse;","uniform vec3 uResolution;","uniform vec3 uLightPosition[LIGHTS];","uniform vec4 uLightAmbient[LIGHTS];","uniform vec4 uLightDiffuse[LIGHTS];","varying vec4 vColor;","void main() {","vColor = vec4(0.0);","vec3 position = aPosition / uResolution * 2.0;","for (int i = 0; i < LIGHTS; i++) {","vec3 lightPosition = uLightPosition[i];","vec4 lightAmbient = uLightAmbient[i];","vec4 lightDiffuse = uLightDiffuse[i];","vec3 ray = normalize(lightPosition - aCentroid);","float illuminance = dot(aNormal, ray);","if (aSide == 0.0) {","illuminance = max(illuminance, 0.0);","} else if (aSide == 1.0) {","illuminance = abs(min(illuminance, 0.0));","} else if (aSide == 2.0) {","illuminance = max(abs(illuminance), 0.0);","}","vColor += aAmbient * lightAmbient;","vColor += aDiffuse * lightDiffuse * illuminance;","}","vColor = clamp(vColor, 0.0, 1.0);","gl_Position = vec4(position, 1.0);","}"].join("\n")},a.WebGLRenderer.FS=function(a){return["precision mediump float;","varying vec4 vColor;","void main() {","gl_FragColor = vColor;","}"].join("\n")},a.SVGRenderer=function(){a.Renderer.call(this),this.element=document.createElementNS(a.SVGNS,"svg"),this.element.setAttribute("xmlns",a.SVGNS),this.element.setAttribute("version","1.1"),this.element.style.display="block",this.setSize(300,150)},a.SVGRenderer.prototype=Object.create(a.Renderer.prototype),a.SVGRenderer.prototype.setSize=function(b,c){return a.Renderer.prototype.setSize.call(this,b,c),this.element.setAttribute("width",b),this.element.setAttribute("height",c),this},a.SVGRenderer.prototype.clear=function(){a.Renderer.prototype.clear.call(this);for(var b=this.element.childNodes.length-1;b>=0;b--)this.element.removeChild(this.element.childNodes[b]);return this},a.SVGRenderer.prototype.render=function(b){a.Renderer.prototype.render.call(this,b);var c,d,e,f,g,h;for(c=b.meshes.length-1;c>=0;c--)if(d=b.meshes[c],d.visible)for(d.update(b.lights,!0),e=d.geometry.triangles.length-1;e>=0;e--)f=d.geometry.triangles[e],f.polygon.parentNode!==this.element&&this.element.appendChild(f.polygon),g=this.formatPoint(f.a)+" ",g+=this.formatPoint(f.b)+" ",g+=this.formatPoint(f.c),h=this.formatStyle(f.color.format()),f.polygon.setAttributeNS(null,"points",g),f.polygon.setAttributeNS(null,"style",h);return this},a.SVGRenderer.prototype.formatPoint=function(a){return this.halfWidth+a.position[0]+","+(this.halfHeight-a.position[1])},a.SVGRenderer.prototype.formatStyle=function(a){var b="fill:"+a+";";return b+="stroke:"+a+";"},a}var c=U(),d=document.createElement("div");a.appendChild(d);var g,e={width:1.2,height:1.2,depth:10,segments:16,slices:8,xRange:.8,yRange:.1,zRange:1,ambient:"#555555",diffuse:"#FFFFFF",speed:.002},f={count:2,xyScalar:1,zOffset:100,ambient:"#000000",diffuse:"#0d5c57",speed:.001,gravity:1200,dampening:.95,minLimit:10,maxLimit:null,minDistance:20,maxDistance:400,autopilot:!1,draw:!1,bounds:c.Vector3.create(),step:c.Vector3.create(Math.randomInRange(.2,1),Math.randomInRange(.2,1),Math.randomInRange(.2,1))};if(b){if(b.MESH)for(g in b.MESH)e[g]=b.MESH[g];if(b.LIGHT)for(g in b.LIGHT)f[g]=b.LIGHT[g]}else b={};b.mode||(b.mode={});var h="webgl",i="canvas",j="svg",k={renderer:i};b.mode.display&&(k.renderer=b.mode.display);var n,v,w,x,y,z,A,B,C,o=Date.now(),p=c.Vector3.create(),q=c.Vector3.create(),r=a,t=(document.getElementById("controls"),d);document.getElementById("ui");F()}